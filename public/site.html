<!DOCTYPE html>
<html>
<head>
  <link rel="favicon" type="image/png" href="/img/logo.png">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans+Mono:400" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/octicons/4.4.0/font/octicons.min.css" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <style>
    body {
      min-width: 1024px;
      min-height: 720px;
      margin: 0;
      background-color: #000;
      font-family: 'Open Sans';
      font-weight: 300;
      color: #FFF;
      overflow-x: hidden;
    }
    header {
      display: flex;
      position: relative;
      height: 100px;
      padding: 0 30px;
      background-color: #000;
      align-items: center;
      z-index: 1;
    }
    a {
      color: inherit;
      text-decoration: none;
      outline: none;
      cursor: pointer;
    }
    .link {
      text-decoration: underline;
    }
    .link:hover {
      color: #AAA;
    }
    .canvas-login-arrow {
      position: absolute;
      width: 600px;
      height: 600px;
      filter: brightness(1000000%);
      pointer-events: none;
      z-index: 2;
    }
    .header-icon {
      margin-right: 10px;
    }
    .header-logo-anchor {
      display: flex;
      margin-right: auto;
      font-size: 20px;
      align-items: center;
    }
    .header-logo-anchor:hover {
      color: #8BC34A;
    }
    .header-github-anchor {
      display: flex;
      width: 50px;
      height: 50px;
      color: #FFF;
      justify-content: center;
      align-items: center;
    }
    .header-github-anchor:hover {
      color: #2196F3;
    }
    .header-github-anchor > i {
      display: block;
      font-size: 30px !important;
    }
    .container {
      display: flex;
      width: 100%;
      height: 720px;
      margin-top: -100px;
      margin-bottom: -100px;
      padding-top: 100px;
      padding-bottom: 100px;
      background-color: #000;
      justify-content: flex-start;
      align-items: center;
      flex-direction: column;
      box-sizing: border-box;
    }
    .container-wrapper {
      display: flex;
      width: 480px;
      color: #FFF;
      align-items: center;
      flex-direction: column;
    }
    .container-wrapper > p {
      width: 100%;
      margin: 30px 0;
      font-size: 14px;
      font-weight: 300;
      line-height: 1.6;
    }
    .container-footer {
      width: 200%;
      height: 400px;
      margin-left: -50%;
      margin-top: -200px;
      position: absolute;
      background-color: #000;
      transform: rotateZ(-10deg);
    }
    section {
      display: flex;
      width: 100%;
      padding-top: 350px;
      background-color: #222;
      justify-content: center;
    }
    .section-wrap {
      width: 760px;
    }
    .section-wrap > h3 {
      display: flex;
      justify-content: center;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
    }
    .grid-item {
      display: flex;
      width: 50%;
      padding: 30px;
      flex-direction: column;
      align-items: center;
      box-sizing: border-box;
    }
    .grid-item > .icon {
      display: flex;
      width: 200px;
      height: 120px;
      font-size: 100px;
      justify-content: center;
      align-items: center;
    }
    .grid-item-1 > .icon {
    }
    .grid-item-2 > .icon {
      color: #2196F3;
    }
    .grid-item-3 > .icon {
      color: #9C27B0;
    }
    .grid-item-4 > .icon {
      color: #4CAF50;
    }
    .grid-item > h4 {
      width: 100%;
      margin-bottom: 10px;
    }
    .grid-item > p {
      font-size: 14px;
      line-height: 1.6;
    }
    .grid-item > p > .link {
      display: block;
      margin-top: 15px;
    }
    h1, h2, h3, h4, p {
      margin: 0;
      font-weight: 300;
      line-height: 1.4;
    }
    h1 {
      font-size: 36px;
    }
    h2 {
      margin-bottom: 10px;
      font-size: 18px;
    }
    h3 {
      font-size: 40px;
    }
    h4 {
      font-size: 24px;
    }
    form, .login-loader {
      display: flex;
      width: 350px;
      height: 226px;
      flex-direction: column;
    }
    form {
      margin-bottom: 20px;
      padding: 20px;
      box-sizing: border-box;
      z-index: 1;
    }
    .login-form {
      background-color: #202020;
    }
    .connect-form {
      padding: 0;
    }
    .connect-form > h2 {
      margin: 0;
      padding: 20px;
      background-color: #4CAF50;
    }
    .connect-form > .buttons {
      padding: 20px;
      background-color: #333;
    }
    input[type=email], input[type=password] {
      margin-bottom: 20px;
      padding: 10px;
      background-color: #AAA;
      border: 0;
      box-shadow: inset 0 5px 0 #2196f3;
      font-size: 14px;
      outline: none;
      transition: box-shadow 0.1s ease-out;
    }
    input[type=email]::-webkit-input-placeholder, input[type=password]::-webkit-input-placeholder {
      font-family: 'Open Sans';
      color: #666;
    }
    input[type=email]:focus, input[type=password]:focus {
      background-color: #FFF;
      box-shadow: none;
    }
    .buttons {
      display: flex;
    }
    .button {
      display: flex;
      width: 100%;
      padding: 8px;
      background-color: transparent;
      border: 1px solid;
      border-radius: 100px;
      font-family: 'Open Sans';
      font-size: 14px;
      font-weight: 300;
      color: #FFF;
      justify-content: center;
      outline: none;
      cursor: pointer;
    }
    .button:hover, .button:focus {
      color: #4CAF50;
    }
    .button:active {
      background-color: #1B5E20;
    }
    .button.sub:hover, .button.sub:focus {
      background-color: transparent;
      color: #E91E63;
    }
    .button.sub:active {
      color: #AD1457;
    }
    .button + .button {
      margin-left: 20px;
    }
    .aside {
      position: absolute;
      margin-top: 70px;
      opacity: 0.5;
    }
    .aside:hover {
      opacity: 1;
    }
    .aside.left {
      padding: 0 10px;
    }
    .aside.right {
      right: 0;
      width: 350px;
      padding: 0 20px;
      background-color: #333;
      border-top: 3px solid #8BC34A;
      border-top-left-radius: 5px;
      border-bottom-left-radius: 5px;
      box-sizing: border-box;
      z-index: 1;
    }
    .aside-heading {
      display: flex;
      margin: 0 -20px;
      padding: 0 20px;
      padding-top: 10px;
      padding-bottom: 10px;
      background-color: #222;
      border-bottom: 1px solid #000;
    }
    .aside-heading > .left {
      font-size: 13px;
      font-weight: 600;
      flex-grow: 1;
    }
    .aside-heading > .right {
      display: flex;
      font-size: 13px;
      align-items: center;
    }
    ul {
      margin: 0 -20px;
      padding: 0 20px;
      list-style: none;
    }
    li {
      display: flex;
      margin: 0 -20px;
      padding: 10px 20px;
    }
    li:not(:last-child) {
      border-bottom: 1px solid #000;
    }
    li > img {
      width: 50px;
      height: 50px;
      margin-right: 10px;
    }
    li > .wrap {
      width: 250px;
    }
    li > .wrap > .title {
      font-size: 13px;
      font-weight: 400;
    }
    li > .wrap > .description {
      margin-bottom: 2px;
      font-size: 11px;
    }
    li > .wrap > .author {
      font-size: 11px;
    }
    li:hover {
      background-color: #666;
      cursor: pointer;
    }
    .stat {
      display: flex;
      padding: 10px 0;
    }
    .stat + .stat {
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }
    .stat > .label {
      display: flex;
      margin-right: 10px;
      font-size: 15px;
      justify-content: center;
      align-items: center;
    }
    .video {
      display: flex;
      margin-bottom: -300px;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    .video-shadow {
      position: absolute;
      width: 600px;
      height: 444px;
      background-color: #666;
      transform: skew(60deg) scaleY(0.7);
      transform-origin: 50% 100%;
      z-index: 1;
    }
    video {
      position: relative;
      width: 600px;
      height: 444px;
      background-color: #FFF;
      z-index: 1;
    }
    footer {
      display: flex;
      height: 100px;
      padding: 0 30px;
      font-size: 13px;
      justify-content: center;
      align-items: center;
    }
    .footer-left {
      margin-right: auto;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
  <style>
    .loader,
    .loader:before,
    .loader:after {
      border-radius: 50%;
    }
    .loader {
      color: #ffffff;
      font-size: 11px;
      text-indent: -99999em;
      margin: 40px auto;
      position: relative;
      width: 10em;
      height: 10em;
      box-shadow: inset 0 0 0 2px;
      -webkit-transform: scale(0.5) translateZ(0);
      -ms-transform: scale(0.5) translateZ(0);
      transform: scale(0.5) translateZ(0);
    }
    .loader:before,
    .loader:after {
      position: absolute;
      content: '';
    }
    .loader:before {
      width: 5.2em;
      height: 10.2em;
      background: #000;
      border-radius: 10.2em 0 0 10.2em;
      top: -0.1em;
      left: -0.1em;
      -webkit-transform-origin: 5.2em 5.1em;
      transform-origin: 5.2em 5.1em;
      -webkit-animation: load2 1s infinite ease 0.75s;
      animation: load2 1s infinite ease 0.75s;
    }
    .loader:after {
      width: 5.2em;
      height: 10.2em;
      background: #000;
      border-radius: 0 10.2em 10.2em 0;
      top: -0.1em;
      left: 5.1em;
      -webkit-transform-origin: 0px 5.1em;
      transform-origin: 0px 5.1em;
      -webkit-animation: load2 1s infinite ease;
      animation: load2 1s infinite ease;
    }
    @-webkit-keyframes load2 {
      0% {
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
      }
      100% {
        -webkit-transform: rotate(360deg);
        transform: rotate(360deg);
      }
    }
    @keyframes load2 {
      0% {
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
      }
      100% {
        -webkit-transform: rotate(360deg);
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="https://zeo.sh" class=header-logo-anchor><img width=32 height=51 src="/img/logo.png" class=header-icon>zeo</a>
    <a href="https://github.com/modulesio/zeo" class=header-github-anchor><i class="octicon octicon-mark-github"></i></a>
  </header>
  <aside class="aside left">
    <div class=stat>
      <div class=label>10 Worlds</div>
      <svg width="155" height="30">
        <defs>
          <linearGradient id="gradient-72706005" x1="0" x2="0" y1="1" y2="0">
              <stop offset="10%" stop-color="#d6e685"></stop>
              <stop offset="33%" stop-color="#8cc665"></stop>
              <stop offset="66%" stop-color="#44a340"></stop>
              <stop offset="90%" stop-color="#1e6823"></stop>
          </linearGradient>
          <mask id="sparkline-72706005" x="0" y="0" width="155" height="28">
            <polyline transform="translate(0, 28) scale(1,-1)" points="0,1.0 3,1.0 6,1.0 9,1.0 12,1.0 15,1.0 18,1.0 21,1.0 24,1.0 27,1.0 30,1.0 33,1.0 36,1.0 39,1.0 42,1.0 45,1.0 48,1.0 51,1.0 54,1.0 57,1.0 60,1.0 63,1.0 66,1.0 69,1.0 72,1.0 75,1.0 78,1.0 81,1.0 84,1.0 87,1.0 90,1.0 93,1.0 96,1.0 99,1.0 102,1.0 105,1.0 108,1.0 111,1.0 114,1.0 117,1.0 120,5.34 123,3.1 126,5.08 129,19.67 132,2.71 135,6.13 138,8.89 141,8.89 144,29.0 147,18.22 150,9.41 153,2.9699999999999998 " fill="transparent" stroke="#8cc665" stroke-width="2">
          </polyline></mask>
        </defs>

        <g transform="translate(0, 2.0)">
          <rect x="0" y="-2" width="155" height="30" style="stroke: none; fill: url(#gradient-72706005); mask: url(#sparkline-72706005)"></rect>
        </g>
      </svg>
    </div>
    <div class=stat>
      <div class=label>3 Users</div>
      <svg width="155" height="30">
        <defs>
          <linearGradient id="gradient-576201" x1="0" x2="0" y1="1" y2="0">
              <stop offset="10%" stop-color="#d6e685"></stop>
              <stop offset="33%" stop-color="#8cc665"></stop>
              <stop offset="66%" stop-color="#44a340"></stop>
              <stop offset="90%" stop-color="#1e6823"></stop>
          </linearGradient>
          <mask id="sparkline-576201" x="0" y="0" width="155" height="28">
            <polyline transform="translate(0, 28) scale(1,-1)" points="0,6.28 3,4.68 6,7.95 9,7.39 12,10.52 15,10.1 18,7.74 21,9.55 24,4.68 27,5.59 30,5.45 33,4.27 36,3.71 39,3.78 42,3.78 45,1.97 48,5.72 51,2.88 54,5.1 57,2.74 60,4.75 63,4.54 66,5.72 69,1.97 72,1.83 75,2.1799999999999997 78,2.3899999999999997 81,2.3200000000000003 84,3.64 87,5.03 90,2.6 93,2.3899999999999997 96,3.92 99,4.470000000000001 102,4.68 105,2.74 108,1.9 111,2.67 114,3.08 117,3.92 120,5.31 123,8.3 126,29.0 129,9.41 132,7.04 135,8.02 138,11.98 141,9.75 144,3.43 147,3.22 150,6.49 153,6.7 " fill="transparent" stroke="#8cc665" stroke-width="2">
          </polyline></mask>
        </defs>

        <g transform="translate(0, 2.0)">
          <rect x="0" y="-2" width="155" height="30" style="stroke: none; fill: url(#gradient-576201); mask: url(#sparkline-576201)"></rect>
        </g>
      </svg>
    </div>
    <div class=stat>
      <div class=label>16 Modules</div>
      <svg width="155" height="30">
        <defs>
          <linearGradient id="gradient-75967915" x1="0" x2="0" y1="1" y2="0">
              <stop offset="10%" stop-color="#d6e685"></stop>
              <stop offset="33%" stop-color="#8cc665"></stop>
              <stop offset="66%" stop-color="#44a340"></stop>
              <stop offset="90%" stop-color="#1e6823"></stop>
          </linearGradient>
          <mask id="sparkline-75967915" x="0" y="0" width="155" height="28">
            <polyline transform="translate(0, 28) scale(1,-1)" points="0,14.31 3,15.17 6,13.1 9,12.58 12,11.72 15,10.33 18,8.95 21,9.81 24,9.12 27,10.16 30,11.2 33,9.99 36,11.54 39,12.06 42,13.1 45,13.27 48,13.27 51,12.23 54,12.06 57,8.6 60,5.32 63,11.37 66,11.37 69,9.47 72,9.3 75,10.16 78,4.98 81,8.09 84,8.26 87,12.06 90,9.64 93,7.74 96,8.26 99,15.69 102,12.06 105,11.89 108,6.53 111,12.23 114,12.06 117,10.16 120,7.22 123,10.33 126,8.43 129,9.3 132,29.0 135,3.59 138,1.0 141,1.0 144,1.0 147,1.0 150,1.0 153,1.0 " fill="transparent" stroke="#8cc665" stroke-width="2">
          </polyline></mask>
        </defs>

        <g transform="translate(0, 2.0)">
          <rect x="0" y="-2" width="155" height="30" style="stroke: none; fill: url(#gradient-75967915); mask: url(#sparkline-75967915)"></rect>
        </g>
      </svg>
    </div>
  </aside>
  <aside class="aside right">
    <h3 class=aside-heading>
      <span class=left>This week's free modules</span>
      <span class=right>
        <a href="#" class=link>Learn more</a>
      </span>
    </h3>
    <ul>
      <li>
        <img src="https://placehold.it/50x50" width=50 height=50>
        <div class=wrap>
          <div class=title>bouncy-ball</div>
          <div class=description>A simple bouncy ball plugin.</div>
          <div class=author>by <b>Avaer</b></div>
        </div>
      </li>
      <li>
        <img src="https://placehold.it/50x50" width=50 height=50>
        <div class=wrap>
          <div class=title>mc</div>
          <div class=description>Minecraft-like demo in VR.</div>
          <div class=author>by <b>Avaer</b></div>
        </div>
      </li>
      <li>
        <img src="https://placehold.it/50x50" width=50 height=50>
        <div class=wrap>
          <div class=title>zeo-model</div>
          <div class=description>Load 3D models from various formats and place them in the world scene.</div>
          <div class=author>by <b>Avaer</b></div>
        </div>
      </li>
    </ul>
  </aside>
  <div class=container>
    <div class=container-wrapper>
      <h1>WebVR universes powered by NPM</h1>
      <p>
        Install node_modules to your face. Build a persistent universe with Javascript, multiplayer, server-side physics and more.<br/><br/>
        From your browser.<br/><br/>
        It's <a href="https://github.com/modulesio/zeo" class=link>open source</a>. Or, pay me for hosting!
      </p>
      <canvas id=canvas-login-arrow class=canvas-login-arrow width=1200 height=1200></canvas>
      <form id=login-form class=login-form>
        <h2>Log in</h2>
        <input type=email placeholder="your@email.com" autofocus id=email>
        <input type=password placeholder="password" id=password>
        <div class=buttons>
          <input type=submit value='Connect' class=button>
          <a href class="button sub">Learn more</a>
        </div>
      </form>
      <form id=connect-form class=connect-form style="display: none;">
        <h2>Welcome back, <span id=connect-form-username>username</span>!</h2>
        <div class=buttons>
          <input type=submit value='Connect' class=button>
          <input type=button value='Log out' id=log-out-button class="button sub">
        </div>
      </form>
      <div id=login-loader style="display: none;">
        <div class=loader>Loading...</div>
      </div>
    </div>
  </div>
  <div class=video>
    <div class=video-shadow></div>
    <video autoplay loop>
      <source src="https://cdn.rawgit.com/modulesio/zeo-data/fa848ef03608c5079237565c8389afafaf5e93ba/video/demo.webm" type="video/webm">
    </video>
  </div>
  <div class=container-footer>
  </div>
  <section>
    <div class=section-wrap>
      <div class=grid>
        <div class="grid-item grid-item-1">
          <img src="https://cdn.rawgit.com/npm/logos/ebb99a82/%22npm%22%20lockup/npm-logo-simplifed-with-white-space.png" class=icon>
          <h4>Powered by npm</h4>
          <p>
            You know Javascript. Now meet face-to-face.<br/>
            Publish to NPM and experience living modules in your headset.<br/>
            <a href="https://github.com/modulesio/zeo" class=link>Read API docs</a>
          </p>
        </div>
        <div class="grid-item grid-item-2">
          <i class="icon octicon octicon-circuit-board"></i>
          <h4>Multiplayer multiverse</h4>
          <p>
            Multiplayer networking, voice chat, server-side physics, plugin management, metaverse links.<br/>
            It's in the box.<br/>
            <a href="https://github.com/modulesio/zeo" class=link>See all features</a>
          </p>
        </div>
        <div class="grid-item grid-item-3">
          <i class="icon octicon octicon-heart"></i>
          <h4>Let's do it together</h4>
          <p>
            Multiplayer networking, server-side physics, plugin management, inter-world linking.<br/>
            It's in the box.<br/>
            <a href="https://github.com/modulesio/zeo" class=link>See all features</a>
          </p>
        </div>
        <div class="grid-item grid-item-4">
          <i class="icon octicon octicon-broadcast"></i>
          <h4>Let's do it together</h4>
          <p>
            Multiplayer networking, server-side physics, plugin management, inter-world linking.<br/>
            It's in the box.<br/>
            <a href="https://github.com/modulesio/zeo" class=link>See all features</a>
          </p>
        </div>
      </div>
    </div>
  </section>
  <!-- <div class=container>
    <div class=video-wrapper>
      <video autoplay loop>
        <source src="https://cdn.rawgit.com/modulesio/zeo-data/fa848ef03608c5079237565c8389afafaf5e93ba/video/demo.webm" type="video/webm">
      </video>
    </div>
    <div class=container-overlay>
      <div class=container-wrapper>
        <div class=container-header>
          <h1>zeo.sh</h1>
        </div>
        <nav class=navbar>
          <a href="#" class=nav>
            <i class="octicon octicon-gist"></i>
            <span>Developer</span>
          </a>
          <a href="#" class="nav highlight">
            <i class="octicon octicon-location"></i>
            <span>Explorer</span>
          </a>
          <a href="#" class=nav>
            <i class="octicon octicon-dashboard"></i>
            <span>Advertiser</span>
          </a>
        </nav>
        <section>
<div class=subsections>
  <div class="subsection main">
    <h2>Make VR, make money</h2>
    <p><b>Zeo lets you build WebVR worlds with Javascript + <a class=link href="https://npmjs.org">npm</a> and get paid for it.</b></p>
    <p>Headset + controller tracking, server-side physics, multiplayer, UI framework, positional audio and more. It's all plain JS, <a class=link href="https://threejs.org/">THREE.js</a>, and <a class=link href="https://npmjs.org">npm</a>.</p>
    <p>Zeo pays you with in-world VR advertising and analytics.</p>
    <p><a class="cta-item purple" href="https://github.com/modulesio/zeo">Start developing</a> or <a class=link href="https://github.com/modulesio/zeo">How Zeo works</a>.</p>
  </div>
  <div class="subsection aside">
    <i class="aside-icon purple octicon octicon-tools"></i>
    <i class="aside-icon purple fa fa-money"></i>
    <i class="aside-icon purple octicon octicon-heart" style="position: relative; left: 7px;"></i>
  </div>
</div>
        </section>
        <section class=highlight>
<div class=subsections>
  <div class="subsection main">
    <h2>WebVR worlds with NPM</h2>
    <pre><span class=dollar>$ </span>npm install zeo<span class=comment> # requires node 6+</span></pre>
    <p><b>Zeo is a WebVR server powered by Javascript + <a class=link href="https://npmjs.org">npm</a>.</b></p>
    <p>Npm install objects from the browser without taking off your headset. Or just use keyboard + mouse.</p>
    <p>Open source on Github. Plugins are funded by in-world ads.</b></p>
    <p><a class="cta-item red" href="https://github.com/modulesio/zeo">Get started with Zeo</a></p>
  </div>
  <div class="subsection aside">
    <i class="aside-icon gray large octicon octicon-telescope"></i>
  </div>
</div>
        </section>
        <section>
<h2>VR advertising is here</h2>
<p class=big>Start a conversation that touches your audience. Literally.</p>
<div class=intermission>
  <i class="intermission-icon octicon octicon-hubot"></i>
</div>
<p>In-world advertising uses the same Javascript VR content engine that powers Zeo to deliver custom ad experiences for your brand.<br/><b>Immersive analytics</b> give you insights through the eyes of your customer.</p>
<p><a class="cta-item green" href="mailto:a@modules.io">Contact us</a> or <a class=link href="mailto:a@modules.io">discover the Zeo ad program</a>.</p>
        </section>
      </div>
    </div>
  </div> -->
  <footer>
    <aside class=footer-left><a href="/">Home</a> | <a href="https://github.com/modulesio/zeo">Github</a> | <a href="mailto:a@modules.io">Contact</a></aside>
    <aside class=footer-right>&copy; 2017 <a href="mailto:a@modules.io">Avaer Kazmer</a></aside>
  </footer>
  <script>
const $ = s => document.querySelectorAll(s);
const loginForm = $('#login-form')[0];
const connectForm = $('#connect-form')[0];
const emailInput = $('#email')[0];
const passwordInput = $('#password')[0];
const loginLoader = $('#login-loader')[0];
const canvasLoginArrow = $('#canvas-login-arrow')[0];
const connectFormUsername = $('#connect-form-username')[0];
const logOutButton = $('#log-out-button')[0];

const _drawCanvasLoginArrow = canvas => {
  const ctx = canvas.getContext('2d');

  ctx.strokeStyle = '#FFF';
  ctx.lineWidth = 1;

  const startX = 640;
  const endX = 930;
  const startY = 500;

  const tick = 55;
  const tock = Math.sqrt((tick * tick) + (tick * tick));
  const tack = 50;

  ctx.beginPath();
  ctx.moveTo(startX, startY);
  ctx.lineTo(endX, startY);
  ctx.lineTo(endX + tick, startY + tick);
  ctx.lineTo(endX + tick, startY + tick + tock);
  ctx.lineTo(endX + tick - tack, startY + tick + tock + tack);

  ctx.moveTo(endX + tick - tack, startY + tick + tock + tack);
  ctx.lineTo(endX + tick - tack, startY + tick + tock + tack - tack);

  ctx.moveTo(endX + tick - tack, startY + tick + tock + tack);
  ctx.lineTo(endX + tick - tack + tack, startY + tick + tock + tack);

  ctx.stroke();
};
_drawCanvasLoginArrow(canvasLoginArrow);

const _login = j => fetch('/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify(j),
}).then(res => {
  if (res.status >= 200 && res.status < 300) {
    return res.json();
  } else {
    const err = new Error('failed to log in');
    return Promise.reject(err);
  }
});

const _jsonParse = s => {
  let err = null;
  let result;
  try {
    result = JSON.parse(tokenString);
  } catch (e) {
    err = e;
  }
  if (!err) {
    return result;
  } else {
    return null;
  }
};

const tokenString = localStorage.getItem('token');
if (tokenString) {
  const token = _jsonParse(tokenString);

  if (token) {
    loginForm.style.display = 'none';
    loginLoader.style.display = null;

    _login({
      token,
    })
      .then(j => {
        const {username} = j;

        connectFormUsername.innerText = username;

        connectForm.style.display = null;
        loginLoader.style.display = 'none';
      })
      .catch(err => {
        console.warn(err);

        loginForm.style.display = null;
        loginLoader.style.display = 'none';
      });
  }
}

loginForm.addEventListener('submit', e => {
  if (emailInput.value && emailInput.checkValidity() && passwordInput.value && passwordInput.checkValidity()) {
    loginForm.style.display = 'none';
    loginLoader.style.display = null;

    const {value: username} = emailInput;
    const {value: password} = passwordInput;
    _login({
      username,
      password,
    })

      .then(j => {
        const {token} = j;

        const s = JSON.stringify(token);
        localStorage.setItem('token', s);

        connectFormUsername.innerText = username;

        connectForm.style.display = null; // XXX just do the connect here
        loginLoader.style.display = 'none';
      })
      .catch(err => {
        loginForm.style.display = null;
        loginLoader.style.display = 'none';
      });
  }

  e.preventDefault();
});

logOutButton.addEventListener('click', e => {
  localStorage.removeItem('token');

  connectForm.style.display = 'none';
  loginForm.style.display = null;
});
  </script>
</body>
</html>
